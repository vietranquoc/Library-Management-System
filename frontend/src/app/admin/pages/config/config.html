<div class="admin-wrapper">
  <header class="admin-header">
    <div class="logo">üìö Library Management - Admin</div>
    <div class="header-right">
      <a routerLink="/admin/dashboard" class="back-link">‚Üê V·ªÅ Dashboard</a>
    </div>
  </header>

  <div class="admin-container">
    <app-admin-sidebar></app-admin-sidebar>

    <main class="admin-main">
      <div class="page-content">
        <h1>C·∫•u h√¨nh H·ªá th·ªëng</h1>
        <p class="page-description">
          Qu·∫£n l√Ω c√°c thi·∫øt l·∫≠p h·ªá th·ªëng nh∆∞ th·ªùi gian m∆∞·ª£n s√°ch, ti·ªÅn ph·∫°t v√† gi·ªõi h·∫°n m∆∞·ª£n s√°ch.
        </p>

        @if (loadingData) {
          <div class="loading-state">
            <div class="spinner"></div>
            <p>ƒêang t·∫£i c·∫•u h√¨nh...</p>
          </div>
        } @else {
          <div class="config-container">
            <div class="config-card">
              <div class="card-header">
                <h2>‚öôÔ∏è C√†i ƒë·∫∑t H·ªá th·ªëng</h2>
                <p class="card-description">
                  C√°c thay ƒë·ªïi s·∫Ω ƒë∆∞·ª£c √°p d·ª•ng ngay l·∫≠p t·ª©c cho c√°c giao d·ªãch m·ªõi.
                </p>
              </div>

              @if (errorMessage) {
                <div class="alert alert-error">{{ errorMessage }}</div>
              }

              @if (successMessage) {
                <div class="alert alert-success">{{ successMessage }}</div>
              }

              <form [formGroup]="form" (ngSubmit)="onSubmit()">
                <div class="form-section">
                  <h3>üìÖ Th·ªùi gian m∆∞·ª£n s√°ch</h3>
                  <div class="form-group">
                    <label for="loanPeriodDays">
                      S·ªë ng√†y m∆∞·ª£n s√°ch (ng√†y) *
                      <span class="help-text">Th·ªùi gian t·ªëi ƒëa m√† th√†nh vi√™n c√≥ th·ªÉ m∆∞·ª£n m·ªôt cu·ªën s√°ch</span>
                    </label>
                    <input
                      id="loanPeriodDays"
                      type="number"
                      formControlName="loanPeriodDays"
                      min="1"
                      placeholder="V√≠ d·ª•: 7"
                    />
                    @if (form.get('loanPeriodDays')?.invalid && form.get('loanPeriodDays')?.touched) {
                      <span class="error-text">
                        @if (form.get('loanPeriodDays')?.errors?.['required']) {
                          S·ªë ng√†y m∆∞·ª£n s√°ch l√† b·∫Øt bu·ªôc
                        } @else if (form.get('loanPeriodDays')?.errors?.['min']) {
                          S·ªë ng√†y m∆∞·ª£n s√°ch ph·∫£i l·ªõn h∆°n 0
                        }
                      </span>
                    }
                    @if (config) {
                      <div class="info-text">
                        Hi·ªán t·∫°i: <strong>{{ config.loanPeriodDays }} ng√†y</strong>
                      </div>
                    }
                  </div>
                </div>

                <div class="form-section">
                  <h3>üí∞ Ti·ªÅn ph·∫°t</h3>
                  <div class="form-group">
                    <label for="finePerDay">
                      Ti·ªÅn ph·∫°t m·ªói ng√†y qu√° h·∫°n (VND) *
                      <span class="help-text">S·ªë ti·ªÅn ph·∫°t t√≠nh cho m·ªói ng√†y tr·∫£ s√°ch qu√° h·∫°n</span>
                    </label>
                    <input
                      id="finePerDay"
                      type="number"
                      formControlName="finePerDay"
                      min="0"
                      step="1000"
                      placeholder="V√≠ d·ª•: 10000"
                    />
                    @if (form.get('finePerDay')?.invalid && form.get('finePerDay')?.touched) {
                      <span class="error-text">
                        @if (form.get('finePerDay')?.errors?.['required']) {
                          Ti·ªÅn ph·∫°t m·ªói ng√†y l√† b·∫Øt bu·ªôc
                        } @else if (form.get('finePerDay')?.errors?.['min']) {
                          Ti·ªÅn ph·∫°t m·ªói ng√†y ph·∫£i l·ªõn h∆°n ho·∫∑c b·∫±ng 0
                        }
                      </span>
                    }
                    @if (config) {
                      <div class="info-text">
                        Hi·ªán t·∫°i: <strong>{{ formatCurrency(config.finePerDay) }}</strong>
                      </div>
                    }
                  </div>
                </div>

                <div class="form-section">
                  <h3>üìö Gi·ªõi h·∫°n m∆∞·ª£n s√°ch</h3>
                  <div class="form-group">
                    <label for="maxBooksPerMember">
                      S·ªë s√°ch t·ªëi ƒëa m·ªói th√†nh vi√™n *
                      <span class="help-text">S·ªë l∆∞·ª£ng s√°ch t·ªëi ƒëa m√† m·ªôt th√†nh vi√™n c√≥ th·ªÉ m∆∞·ª£n c√πng l√∫c</span>
                    </label>
                    <input
                      id="maxBooksPerMember"
                      type="number"
                      formControlName="maxBooksPerMember"
                      min="1"
                      placeholder="V√≠ d·ª•: 5"
                    />
                    @if (form.get('maxBooksPerMember')?.invalid && form.get('maxBooksPerMember')?.touched) {
                      <span class="error-text">
                        @if (form.get('maxBooksPerMember')?.errors?.['required']) {
                          S·ªë s√°ch t·ªëi ƒëa l√† b·∫Øt bu·ªôc
                        } @else if (form.get('maxBooksPerMember')?.errors?.['min']) {
                          S·ªë s√°ch t·ªëi ƒëa ph·∫£i l·ªõn h∆°n 0
                        }
                      </span>
                    }
                    @if (config) {
                      <div class="info-text">
                        Hi·ªán t·∫°i: <strong>{{ config.maxBooksPerMember }} cu·ªën</strong>
                      </div>
                    }
                  </div>
                </div>

                <div class="form-actions">
                  <button type="submit" class="submit-btn" [disabled]="loading || form.invalid">
                    @if (loading) {
                      <span class="btn-spinner"></span>
                      ƒêang c·∫≠p nh·∫≠t...
                    } @else {
                      üíæ L∆∞u c·∫•u h√¨nh
                    }
                  </button>
                  <button type="button" class="cancel-btn" (click)="loadConfig()" [disabled]="loading">
                    üîÑ L√†m m·ªõi
                  </button>
                </div>
              </form>
            </div>

            @if (config) {
              <div class="info-card">
                <h3>‚ÑπÔ∏è Th√¥ng tin</h3>
                <div class="info-list">
                  <div class="info-item">
                    <span class="info-label">ID c·∫•u h√¨nh:</span>
                    <span class="info-value">#{{ config.id }}</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">Th·ªùi gian m∆∞·ª£n:</span>
                    <span class="info-value">{{ config.loanPeriodDays }} ng√†y</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">Ti·ªÅn ph·∫°t/ng√†y:</span>
                    <span class="info-value">{{ formatCurrency(config.finePerDay) }}</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">Gi·ªõi h·∫°n m∆∞·ª£n:</span>
                    <span class="info-value">{{ config.maxBooksPerMember }} cu·ªën</span>
                  </div>
                </div>
              </div>
            }
          </div>
        }
      </div>
    </main>
  </div>
</div>

